<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Memory Match - v26.1</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #fce4ec; font-family: sans-serif; touch-action: none; position: fixed; width: 100%; height: 100%; }
        
        /* ‰∏ä‰∏ãÂ∫ÉÂëäÔºö100px */
        #ad-top, #ad-bottom { position: fixed; left: 0; width: 100%; height: 100px; background: #333; z-index: 100; display: flex; align-items: center; justify-content: center; }
        #ad-top { top: 0; border-bottom: 1px solid #444; } 
        #ad-bottom { bottom: 0; border-top: 1px solid #444; }
        iframe { border: none; width: 100%; height: 100px; background: #333; }

        #game-outer { position: absolute; top: 100px; bottom: 100px; left: 0; right: 0; background: #fce4ec; overflow: hidden; display: flex; flex-direction: column; }
        #header-ui { width: 100%; display: flex; justify-content: space-around; padding: 8px 0; z-index: 10; flex-shrink: 0; }
        .ui-box { padding: 4px 10px; border-radius: 12px; font-weight: bold; font-size: 16px; color: #ad1457; background: white; box-shadow: 0 2px #f48fb1; }

        #grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 10px; width: 95%; max-width: 340px; margin: auto; }
        .card { 
            aspect-ratio: 1/1; background: #f06292; color: white; border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 24px; font-weight: bold; cursor: pointer; box-shadow: 0 3px #c2185b;
            transition: transform 0.2s, background 0.2s; user-select: none; -webkit-tap-highlight-color: transparent;
        }
        .card.open { background: white; color: #ad1457; transform: rotateY(180deg); box-shadow: 0 1px #f48fb1; }
        .card.matched { visibility: hidden; pointer-events: none; }

        #menuScreen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.96); display: flex; flex-direction: column; 
            align-items: center; justify-content: flex-start; z-index: 200; 
            padding: 20px 0; overflow-y: auto;
        }

        /* Ë™§„Çø„ÉÉ„ÉóÈò≤Ê≠¢Áî®„Ç¨„Éº„ÉâË®≠ÂÆö */
        #ad-middle-container { 
            width: 320px; height: 100px; background: #333; margin: 15px 0; 
            display: none; justify-content: center; align-items: center; 
            overflow: hidden; flex-shrink: 0; border: 1px solid #ddd;
            transition: opacity 0.3s;
        }

        .menu-btn-group { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 12px; padding-bottom: 30px; }
        .menu-btn { width: 220px; padding: 14px; font-size: 18px; border: none; border-radius: 30px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; transition: 0.2s; }
        #retry-btn { background: #f06292; color: white; box-shadow: 0 4px #ad1457; }
        #retry-btn:disabled { background: #bbb; box-shadow: 0 4px #888; color: #eee; }
        #more-games-btn { background: #ff4081; color: white; box-shadow: 0 4px #c2185b; }
        .menu-btn:active { transform: translateY(2px); box-shadow: none; }

        #bigAdScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; display: none; justify-content: center; align-items: center; }
        .ad-frame-wrapper { width: 95%; height: 85%; position: relative; }
        .ad-close-btn { position: absolute; top: -15px; right: -15px; color: white; font-size: 32px; font-weight: bold; cursor: pointer; background: rgba(0,0,0,0.7); width: 44px; height: 44px; border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 3100; border: 2px solid white; }
    </style>
</head>
<body>

    <div id="ad-top"><iframe id="frame-top" src="./ad.html?pos=top"></iframe></div>

    <div id="game-outer">
        <div id="header-ui">
            <div id="score-display" class="ui-box">SCORE: 0</div>
            <div id="timer-display" class="ui-box">ÊÆã„Çä: 20s</div>
        </div>
        
        <div id="grid"></div>

        <div id="menuScreen">
            <h2 id="result-msg" style="color:#ad1457; margin: 10px 0; font-size: 26px; text-align: center;">Memory Match</h2>
            
            <div id="ad-middle-container">
                <div id="im-8b492cea6667490da71c488bdcc7cfc8">
                    <script async src="https://imp-adedge.i-mobile.co.jp/script/v1/spot.js?20220104"></script>
                    <script>(window.adsbyimobile=window.adsbyimobile||[]).push({pid:84561,mid:590804,asid:1924211,type:"banner",display:"inline",elementid:"im-8b492cea6667490da71c488bdcc7cfc8"})</script>
                </div>
            </div>

            <div class="menu-btn-group">
                <button id="retry-btn" class="menu-btn" onclick="startNewGame()">„Çπ„Çø„Éº„ÉàÔºÅ</button>
                <a href="https://saaaachi.github.io/" id="more-games-btn" class="menu-btn">‰ªñ„ÅÆ„Ç≤„Éº„É†„ÅØ„Åì„Å°„Çâ</a>
            </div>
        </div>

        <div id="bigAdScreen">
            <div class="ad-frame-wrapper">
                <div id="ad-close-btn" class="ad-close-btn" onclick="closeBigAd()">√ó</div>
                <iframe id="ad-large-frame" src="" style="width:100%; height:100%;"></iframe>
            </div>
        </div>
    </div>

    <div id="ad-bottom"><iframe id="frame-bottom" src="./ad.html?pos=bottom"></iframe></div>

    <script>
        let score = 0, gameActive = false, timeLeft = 20, timerInterval, playCount = 0;
        let flippedCards = [];
        const icons = ['üçé', 'üê±', '‚≠ê', 'üöÄ', 'üåà', 'üíé', 'üçÄ', 'üê≥'];
        
        const grid = document.getElementById("grid");
        const menuScreen = document.getElementById("menuScreen");
        const adMid = document.getElementById("ad-middle-container");
        const resultMsg = document.getElementById("result-msg");
        const retryBtn = document.getElementById("retry-btn");

        function startNewGame() {
            menuScreen.style.display = "none";
            adMid.style.display = "none";
            score = 0; timeLeft = 20; gameActive = true;
            document.getElementById("score-display").innerText = "SCORE: 0";
            setupGrid();
            startTimer();
        }

        function setupGrid() {
            grid.innerHTML = ""; flippedCards = [];
            const deck = [...icons, ...icons].sort(() => Math.random() - 0.5);
            deck.forEach((icon) => {
                const card = document.createElement("div");
                card.className = "card"; card.dataset.icon = icon; card.innerText = "?";
                card.onclick = () => flipCard(card);
                grid.appendChild(card);
            });
        }

        function flipCard(card) {
            if (!gameActive || flippedCards.length >= 2 || card.classList.contains('open')) return;
            card.classList.add('open'); card.innerText = card.dataset.icon; flippedCards.push(card);
            if (flippedCards.length === 2) {
                if (flippedCards[0].dataset.icon === flippedCards[1].dataset.icon) {
                    setTimeout(() => { flippedCards.forEach(c => c.classList.add('matched')); flippedCards = []; checkClear(); }, 400);
                } else {
                    setTimeout(() => { flippedCards.forEach(c => { c.classList.remove('open'); c.innerText = "?"; }); flippedCards = []; }, 700);
                }
            }
        }

        function checkClear() {
            const matchedCount = document.querySelectorAll('.matched').length;
            if (matchedCount === 16) { score++; document.getElementById("score-display").innerText = "SCORE: " + score; timeLeft += 10; setupGrid(); }
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft -= 1;
                document.getElementById("timer-display").innerText = "ÊÆã„Çä: " + Math.max(0, timeLeft) + "s";
                if (timeLeft <= 0) gameOver("ÊôÇÈñìÂàá„ÇåÔºÅ‚è≥");
            }, 1000);
        }

        function gameOver(msg) {
            gameActive = false; clearInterval(timerInterval); playCount++;
            resultMsg.innerText = msg + "\nSCORE: " + score;
            
            retryBtn.innerText = "„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ...";
            retryBtn.disabled = true;
            adMid.style.display = "flex";
            adMid.style.pointerEvents = "none";
            adMid.style.opacity = "0.4";
            
            menuScreen.style.display = "flex";
            menuScreen.scrollTop = 0;

            setTimeout(() => {
                adMid.style.pointerEvents = "auto";
                adMid.style.opacity = "1";
                retryBtn.disabled = false;
                retryBtn.innerText = "„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂";
            }, 1500); // 1.5Áßí„Ç¨„Éº„Éâ

            if (playCount === 3 || (playCount > 3 && (playCount - 3) % 7 === 0)) {
                setTimeout(showBigAd, 500);
            }
        }

        function showBigAd() {
            const screen = document.getElementById("bigAdScreen");
            const closeBtn = document.getElementById("ad-close-btn");
            const frame = document.getElementById("ad-large-frame");
            frame.src = "./ad.large.html?t=" + Date.now();
            screen.style.display = "flex";
            closeBtn.style.display = "none";
            setTimeout(() => { closeBtn.style.display = "flex"; }, 5000);
        }

        function closeBigAd() { document.getElementById("bigAdScreen").style.display = "none"; document.getElementById("ad-large-frame").src = ""; }

        // ‰∏ä‰∏ãÂ∫ÉÂëä„ÅÆ‰∫§‰∫í„É™„Éï„É¨„ÉÉ„Ç∑„É•
        setInterval(() => {
            const f = document.getElementById('frame-top');
            if(f) f.src = "./ad.html?pos=top&t=" + Date.now();
        }, 30000);

        setTimeout(() => {
            setInterval(() => {
                const f = document.getElementById('frame-bottom');
                if(f) f.src = "./ad.html?pos=bottom&t=" + Date.now();
            }, 30000);
        }, 15000);

        window.onload = () => { menuScreen.style.display = "flex"; };
    </script>
</body>
</html>
